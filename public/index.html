<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, maximum-scale=1.0"/>
		<meta name="HandheldFriendly" content="True"/>
		<title>Dice Game Channels</title>

		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/min/1.5/min.min.css">
		<style>
			html, body {
				font-family: 'Roboto', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
				font-size: 14px;
				text-align: left;
				padding: 20px 30px;

				user-select: none;
			}

			#user_balance {
				display: inline-block; min-width: 20px;
			}

			.step {
				margin-bottom: 40px;
			}

			#open_log  { margin: 10px 0;  }
			#open_log > div {
				font-size: 10px;
				margin: 0px 0 2px 0;
				border-bottom: 1px solid #f7f7f7;
				padding: 3px 0 5px 3px;
			}

			.cur-step-0 .step-1 *, .cur-step-0 .step-2 * {
				pointer-events: none; opacity: 0.5;
			}
			.cur-step-1 .step-0 h3 { color: green; }
			.cur-step-1 .step-0 h3:before { content: '✔ '; margin: 10px 5px 10px -23px; }

			.cur-step-1 .step-1 * {
				pointer-events: auto; opacity: 1;
			}

			.cur-step-2 .step-1 h3 { color: green; }
			.cur-step-2 .step-1 h3:before { content: '✔ '; margin: 10px 5px 10px -23px; }
			.cur-step-2 .step-2 * {
				pointer-events: auto; opacity: 1;
			}

			.disabled * {
				pointer-events: none !important; opacity: 0.8 !important;
			}

		</style>

		<!-- <script src="http://localhost:8888/static/js/bundle.js"></script> -->
		<!-- <script src="https://platform.dao.casino/api/lib/DC.js?v=1.4"></script> -->

		<script>
			var GAME_CODE = 'dice_gamechannel'

			document.addEventListener("DOMContentLoaded", function(){
			  window.Casino = new CasinoJS({network: 'ropsten'});
			  window.lightwallet = Casino.Account.lightWallet;

			  initGame()
			});

			function updBalance(){
				document.getElementById('user_balance').innerText = '...'
				Casino.Account.getBetsBalance(function(user_bets){
					document.getElementById('user_balance').innerText = user_bets
					setTimeout(updBalance, 3000)

					if (user_bets>0) {
						document.body.classList.add('cur-step-1')
					}
				})
			}

			function initGame(){
				// updBalance()
				document.body.classList.add('cur-step-1')
				document.getElementById('loading').style.display = 'none'
				document.getElementById('content').style.display = 'block'

				document.getElementById('user_address').innerHTML = '<a target="_blank" href="https://ropsten.etherscan.io/address/'+Casino.Account.get().openkey+'">'+Casino.Account.get().openkey+'</a>'
				document.getElementById('faucet').href = 'https://platform.dao.casino/faucet?to='+Casino.Account.get().openkey

				document.querySelector('.step-1 form').addEventListener('submit', function(e){
					e.preventDefault()

					e.target.classList.add('disabled')

					Casino.startChannelGame(
						GAME_CODE,

						// user deposit
						document.getElementById('user_deposit').value,

						// open result
						function(result){
							console.log('openGamechannel res:', result)
						},

						// log
						function(log){
							var d = document.createElement('div')
							d.innerHTML = ' >> '+log
							document.getElementById('open_log').appendChild(d)
						}
					)
				})
			}
		</script>
	</head>
	<body class="cur-step-0">

		<p id="loading">Loading...</p>

		<section id="content" style="display: none">

			<div id="user" class="step step-0">
				<h3>0. Create account, get BETs</h3>
				<p>
					<b>addr</b>: &nbsp;<span id="user_address"></span>
					<br>
					<br>
					<b>BET</b>: &nbsp;<span id="user_balance"></span>
					&nbsp;
					<a id="faucet" target="_blank" href="">faucet</a>
				</p>
			</div>

			<div class="step step-1">
				<h3>1. Open game-channel</h3>

				<form>
					<label>
						Set game deposit:
						<input id="user_deposit" type="number" value="2" min="0" max="4" step="1">
					</label>
					<input type="submit" value="Set">
				</form>

				<div id="open_log">

				</div>
			</div>

			<form onsubmit="sendNum"  class="step step-2">
				<h3>2. Play</h3>
				<label>
					your bet:
					<input id="user_bet" type="number" value="1" min="0" max="4" step="1">
				</label>
				<label>
					your num:
					<input id="user_num" type="number" value="35000" min="0" max="65000" step="1">
				</label>

				<input type="submit" value="Roll">

			</form>

		</section>
	</body>
</html>
